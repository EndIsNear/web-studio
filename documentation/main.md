- [Уеб базирана среда за разработка на интерактивни уеб приложения с графична насоченост](#уеб-базирана-среда-за-разработка-на-интерактивни-уеб-приложения-с-графична-насоченост)
- [Увод](#увод)
- [Речник](#речник)
- [Описание на проблема](#описание-на-проблема)
- [Описание на решението](#описание-на-решението)
  - [Контролен панел](#контролен-панел)
  - [Описание на резултатния сайт](#описание-на-резултатния-сайт)
    - [Визуална част](#визуална-част)
    - [Програмна част](#програмна-част)
- [Редакотор на кода](#редакотор-на-кода)
- [Използвани технологии](#използвани-технологии)
- [Ръководство за употреба и освновни примери](#ръководство-за-употреба-и-освновни-примери)
  - [Работа с начална страница](#работа-с-начална-страница)
  - [Работа с редактора на код](#работа-с-редактора-на-код)
  - [Основните видове възли-методи в код-графът и техните параметри](#основните-видове-възли-методи-в-код-графът-и-техните-параметри)
    - [Методи за работа с потока (хода) на кода](#методи-за-работа-с-потока-хода-на-кода)
    - [Методи за работа с числа](#методи-за-работа-с-числа)
    - [Методи за работа с масиви](#методи-за-работа-с-масиви)
    - [Методи за рисуване в платно (canvas)](#методи-за-рисуване-в-платно-canvas)
  - [Основни примери](#основни-примери)
- [Заключение](#заключение)
- [Източници](#източници)

# Уеб базирана среда за разработка на интерактивни уеб приложения с графична насоченост

# Увод

Проекта представлява уеб сървър който сервира уеб страница предоставяща възможността да се създават други уеб страници без знания по програмиране - чрез визуално програмиране. Разделя се в две основни части - фронт-енд и бек-енд. Те ще си комуникират чрез web socket протокол. Фронт-енд частта ще дава възможността на потребителя да създава нови елементи в резултатната страница чрез подходящ интерфейс - бутони, тескт, картинки и т.н.. Също така потребителят ще може да програмира интерактивни събития чрез flow-based-programing (https://en.wikipedia.org/wiki/Flow-based_programming). Този модул ще поддържа основни програмни приоми - създава и четене на променлива, възможност за показване на променливите във резултатния сайт, основни математически и логически операции, цикли (while/for), условна конструкция (if, if-else), таймери, възможност за повикване на част от кода след натискане на бутон (button callbacks) и други. Фронт-ендът ще бъде отговорен да сериализира данните въведени от потребителя и да ги изпрати на сървъра (бек-енд). Там те ще бъдат преобразуват до html, css и Vue.js (https://vuejs.org/) за визуалната част. За програмната част ще се десериализира графът от възли и ще бъде транслиран до javascript код. Новополучения сайт ще бъде изпратен обратно до фронтенда и ще бъде показан във финалният му вид на потребителя.


# Речник

- front-end
- back-end
- http/https
- websocket
- canvas
- framework
- json
- node - възел, в частност - метод
- boolean

# Описание на проблема

- система за порграмиране на графични уеб приложения
- различни употреби
  
# Описание на решението

Целта на поставената задача е да се създаде уеб страница (сайт) който да предоставя способността на потребител без програмни познания да създаде интереактвен сайт. Сайта се разделя на два основни компонента, front-end или клиентска част и back-end или сървърна част. Front-end е частта от кода която се изпълнява в клиентския браузър, тя е отговорна за почти всичко което вижда клиентът. Back-end е часта която се изпълнява от частен сървър. Сървръната част е отговорна, за зареждането на страницата във браузъра на клиента посредством https и за последващото обработване на данните на клиента. След като клиентската част бъде заредена от браузъра на клиента, всяка инстанция от нея установява връзка с web socket протокола, посредством него клиетската част може лесно да изпраща и приема данни от сървърната част без да се налага страницата да се презарежда всеки път. 

Клиентската част се състои от две уеб страници. Първата предоставя възможността за контролиране на съдържанието на резултатния уебсайт, както и показва самия резултат в реално време. Текущото решение дава възможност са създаване/изтриване/преместване на бутони, текст и canvas. Втората страница позволява посредством визуално програмиране да се създава логиката зад сайта. Посредством специално пригоден редактор, клиентът може да редактира "кодът" който резултатът ще изпълнява. Тъй като генераторът на код е основната задача в този труд на нея има отделена цяла глава. Всяка от двете страници серилизира всички промени по данните в json формат след което чрез web socket връзката ги изпраща до сървъра. След като сървъра обработи новите данни той връща резултатът отвно през web socket и се показва на потребителя. При добра интернет връзка това се случва моментално и недоловимо за потребителя.

Основната задача на сървърната част е да приема юсърските промени, да ре-генерира резултатът и да го върне обратни на клиента. 

## Контролен панел

описание на основните функции и как работят


## Описание на резултатния сайт

По същество решението на проблемът се разделя в две основни части - визуална и програмна. Отговорнистите на визуалната част се свеждат до презентацията на целия продукт пред потребителя - бутони, тескт, картинки, различни анимации и други. Тя е минималистична, единствената и цел е да може да поддържа работата с програмната, фокусът на тази работа е върху програмната част. Оснвоната задача на програмната част е да предостави на потребителя набор от инструменти чрез който, въпреки че няма необходимите знания по програмирен, на създаде интерактивни елементи в уеб приложението (програми).

### Визуална част
хтмл цсс променливи, възможности пред потребителя и кратко описание как работят

### Програмна част


# Редакотор на кода

Начин на оценяване на графа.
Всички променливи споменати поне един път в редактора на код се създават автоматично

# Използвани технологии

- golang/javascript+vue/HTML+CSS
- Защо?
  - golang - идеален за семпли уеб сървъри като искания тук
  - javascript - лесен за генериране и ъпдейтване
  - html/css - супер лесен език за описване на UI
- websocket - предавене на json-и през уеб сокети
- Описание на използваните frameworks/библиотеки
  - Vue - framework, използван само за data binging - ъпдейтване на UI след като стейта на JS се ъпдейтне.
  - baklava JS - Малка библиотека за визуализация на графът от възли от който се генерира кодът.

# Ръководство за употреба и освновни примери

За да се създаде нова страница обикновенно се добавят нови бутони и текст в началната страница, след което в редакотра за код те могат да се използват. Цялата логика на програмата се създава в редактора на код под формата на граф, създавен от нодове описани по-надолу и връзки между тях.

## Работа с начална страница

![First example](/documentation/images/homepage.png)

Началната страница има 3 основи компонента:

1. Контролен панел - от него могат да се извършват основните операции както следва:
   * Code editor - отраря страницата за редактора на код
   * View the result - Отваря само резултатния сайт в нова страница.
   * CSS (Styling) - Включва и изключва стилъът на сайтът. Когато е изключен изгенерираният CSS файл е празен.
   * Canvas (Drawing) - Когато е включен, резултатния сайт съдържа и платно в което може да се рисува чрез възли в редактора на код.
   * Падащо меню с предварително създадените [примери](#основни-примери), то съдържа седем примера, няколко основни и два по-сложни.
   * Load example - с този бутон се зарежда примерът избран от горното меню.
   * Add button - Добавя бутон в новосъздадения сайт. След натискане се появавят 2 полета за попълване съответно - текст на бутона и уникален идентификатор. Идентификатора се ползва в редактора на код, за да може да се изпълнява логика при натискането му.
   * Add header - Добавя текстово поле в новосъздадения сайт. След натискане на бутона се появява поле за попълване на новият текст.
2. Списък от всички създадени елементи в изходната страница - тази част съдържа лист от всички създадени бутони и текстови полета. Също така всеки елемент има бутон за премахване (изтриване) и са посочени всичките идентификатори на бутоните.
3. Резултатът сайт - той показан в реално време и се обновява след вскяа промяна. 

## Работа с редактора на код

![First example](/documentation/images/codingpage.png)

Страницата с редактора на кода има 2 основни компонента:

1. Контролен панел - от него може да се записва текущото състояние на редактора Save и потребителя да се връща обратно към основната страница - Go Back.
2. Редактора на кодовата схема - тук потребителя може да създава нови възли (методи), връзки между тях и др. Тук си залужава да споменем другите две маркирани части.
3. Меню за създаване на нови възли - наричани още методи. Появява се след натискане на десен бутон в редактора. Различните видове възли ще разгледаме [по-напред в тази глава](#основните-видове-възли-методи-в-код-графът-и-техните-параметри).
4. Така изглежда вече създаден приемр от 4 възли и връзки м/у тях.

## Основните видове възли-методи в код-графът и техните параметри

Всеки възел (метод) в графа е отговорен за ралзична функционалност - наприемр има метод отговорен за записване на число в променлива. Възлите имат 3 различна вида свойстава:
1. Параметри - това е най-простият вид, от тях и към тях не може да има връзки, те служат единствено за описване на възела. Наприемр името на променлива при записване на такава.
2. Входни параметри - Това са параметри които приемат връзки от други възли, понякога може освен входни параметри да са и прости параметри. Например стойностите при събиране на числа.
3. Изходни параметри - Това са параметри от които могат да излизат връзки. Наприемр резултат или ход на програмта.

За да може да се свържат 2 параметъра единият трябва да е изходен а другия входен, освен това трябва да имат еднакъв тип - отбелязан с цвят в редактора. Към момента има три различни вида връзки, по тях "протичат": числа, булеви стойност или ход на програмата (flow).

### Методи за работа с потока (хода) на кода

Този тип възли са отговорини за хода на програмата. От тях започва изпълнението на всеки фрагмент в кода.Също така то се нарпавлява от тях, например с Условие и цикъл.
![First example](/documentation/images/flownodes.png)
Номера от картинката съотвесва на ноемра от списъка, както и името на възела.

1. При започване (On start) - Този метод стартира изпълнението на кода когато резултатната страница се зареди. Той има един единствен параметър и той е изходния поток на кода, т.е. този възел се използва единствено за да извика други възли от графа. Неговата цел е потребителя да има възможността да зададе начални стойности на неговите променли, попринцип те се създават със стойност нула.
2. При времеви интервал (On timer) - Подобно на "On start" този метод стартира изпълнението, но за разлика от него това се случва през определен интервал от време. Освен очакваният изходен параметър за поток на кода, този възел има още един параметър и това е времето през което ще се изпълнява метода в милисекунди. Неговото основно предназначене е да се обновява нещо в изходната страница на определен интервал от време.
3. При клик на бутон (On click) - Този метод се изпозлва като свързочно звено между изходната страница и изходния код. Той отново има изходен параметър за поток на кода, но освен него има и входон параметър - идентификатор на бутон. В това поле се попълва уникален идентификатор на бутон от създадената страница. Всеки път когато този бутон бъде натиснат от потребителя, този метод ще стартира изпълнението на кода свързан към него.
4. При клик на платното за чертаене (On Canvas click) - Този метод е почти идентиче с On Click но за разлика от него е отговорен за кликането в/у платното (ако има такова). Освен обичайният за стартиращите методи изходен параметър - ход на кода, той има още два изходни параметъра от тип число. Те служат за да може да се извлекат координатите в платното (canvas) където потребителя е кликнал, единият дава Х координатата на позицията на мишката, а другия У координатата. Използването на този възел е демонстрирано много добре в примерът "OnClick Velocity".
5. Разделяна на потока (Split flow) - Този метод се изполва зада може от един входен поток потребителя да може да изъплни два други метода. Той има един единствен входен параметърт от тип поток на кода и два изходни параметъра от тип поток на кода. Основното предназначение е да може от един метод да се извикат два други метода (подобно на разклонител).
6. Условие (If/Else) - Този възел имплементира основополагащата в програмирането идея за услвоност. Т.е. потока на кода кода може да се разклони според дадени условия. Той има два входни и два изходни параметъра, входните са условия, от тип булиан и поток, а изходните са поток на кода, ако условието е истина и поток на кода, ако е лъжа. Този метод позволява даден сегменти от кода да се изпълват само ако дадено условие е истина.
7. For цикъл (For loop) - Този възел позволява сегмент от кода да се изпълни няколко пъти без да се налага да се копира йерархията от възли. Подобно на условния метод и този има два входни параметри, входен поток на кода и условие. Изходните параметри са 2 потока на кода, единият (initialization) се изпълнява винаги един път, а след това докато условието входен парамтър е истина се изпълнява вторият (Loop flow). Този метод се използва когато даден сегмент от кода трябва да се изпълни няколко пъти подред (в цикъл). Първият изходен параметър се използва за инициализация на стойностите на променливите, които ще бъдат използвани по време на цикличността, той се извиква само един път в началото. След това се извиква вторият изходен път докато условието е истина, ако то никога не е истина, не се извиква дори и един път.    

### Методи за работа с числа

Тези методи са отговорни за всички операци свързани с числа, както и за четене и записвани на променливи.
![First example](/documentation/images/numnodes.png)

1. Четене на число (Read num) - Този метод позволява да се прочете числова стойност от променлива. Той има два параметъра, име на променливата и стойност. Когато стойноста бъде поискана от друг метод който ще я използва, се прочита променливата с подаденото име и се връща нейната стойност. Ако една променлива бива спомената само в "четене на число", т.е. не се записва стойност в нея никога, връщаният резултат винаги е 0.
2. Писане на число (Write num) - Чрез този метод записваме числова стойност в променлива. Той има три параметъра - входен поток на кода, име на променливата и стойност на променливата. Когато чрез входния поток този метод бъде извикан, той започва да оценява подграфът който е вързан към стойността на променливата. След това получената стойност се записва в променлива с посоченото име, имайте предвид че променливите не се декларират експлицитно, след първото им срещане в какъвто и да е възел, те вече са напълно функционални.
3. Случайно число (Random num) - Този възел може да генерира случайно число в интервал. Той има два входни - миниум и максимум и 1 един изходен параметър - резултат. Когато се поиска стойност от тзи метод той оценява минимума и максимум и връща случайно число в този интервал [min, max). След това получения резултат се предава през изходния параметър на следващия възел.
4. Модул на число (Absolute num) - Този метод връщат резултат абсолютна стойност на подадения параметър. Той има два параметъра - входно число и резултат. Когато резултатът е необходим на друг възел от графа този нод се извиква и се оценява неговия входен параметър, след това през резултатния параметър се подова абсолютната стойност на оценения подграф.
5. Синус (Sinus) - Връща синус от подадения ъгъл. Има два параметъра - входен ъгъл и резултат. Ъгълът се подава в градуси (не в радиани). За да се изчисли резултатът се оценява входния параметър, след което се изчислява синус от полученото число и се подава през реултатния аргумент.
6. Косинус (Cosinus) - Връща косинус от подадения ъгъл. Има два параметъра - входен ъгъл и резултат. Както и в предходния метод Ъгълът се подава в градуси (не в радиани). За да се изчисли резултатът се оценява входния параметър, след което се изчислява косинус от полученото число и се подава през реултатния аргумент.
7. Числови оператори (Operators) - Този метод позволява да се извършват основните числови операции - събиране, изваждане, умножение, деление и целочислено деление с модул. Той има четири параметъра, два входни за двата операнда на операцията - А и Б, един за вида на операцията и последния е резултатът от операцията. Този възел е доста интуитивен, когато се поиска неговото оценяне се оценяват двата му аргумента - А и Б, след което се извържва избраната от падащото меню на възела операция, тя се извършва върву вече оценените операнди и резултата се предава по графът. Този възел поддържа само два операнда, ако искате да съберете три числа е необходиме с един такъв възел да съберете първите две числа и след това резултатът от този възел да го съберете с третото число. С този подход може да композирате много операнди. Важно е да се спомене, че към момента няма защита от деление на 0 и в тези случаи резултатната програма няма да работи правилно.
8. Сравняване на числа (Compare num) - Този тип възел позвонлява базови сравнения меджду 2 числа. Той има 4 параметъра, отново два операнда - А и Б, тип на операцията и резултат, който е от тип буулиан (истина или лъжа). При поискване за оценяване на възела, 2та операнда се оценяват след което се сравняват с операцията избрана от падащото меню и резултат, който е истина или лъжа, се предава през резултатния параметър. Има 6 вида операци:
     - Equal(==) - Ако А и Б са равни връща истина, в противен случай резултата е лъжа.
     - Not Equal(!=) - Ако А и Б са различни връща лъжа, ако ли не връща истина.
     - Greater Than(>) - Проверява дали А е по-голямо от Б и връща истина ако е, в противен случай лъжа.
     - Less Than(<) - Проверява дали А е по-малко от Б и връща истина.
     - Greater or Equal(>=) - Проверява дали А е по-голямо или равно на Б и връща истина ако е.
     - Less or Equal(<=) - Проверява дали А е по-малко или равно на Б и връща истина ако е и лъжа в противен случай.

### Методи за работа с масиви

Тези методи отговарят за всички основни операции с числови масиви. Четене на размер, четене на елемент, добавяне на елемент и други.
![First example](/documentation/images/arraynodes.png)


1. Инициализация на масив (Init array) - Този метод позволява да се инициалзира масив с числа, с други думи да се зададът начални числови стойности. Той има три параметъра, име на масива, нови стойности на масива и входен поток за кода - който предизвиква изпълнението на този възел. Стойноста която ще се използва за инициализиране на масива трябва да бъде числа разделени със запетайки, например "3, 2, 1.5". Този метод е еквивалентен на редица извиквания на "Добавяне на число накрая" (Push back num). 
2. Четене на големината на масив (Read array size) - Този метод позволява да се прочете размера на един числов масив - броя елементи в него. Той има два параметъра име на масива и резултат. Когато се поиска от възеда се оцени той прочита името на променливата, взима размера масива с това и ме и го предава през резултатния параметър. Той често бива използванв комбинация с сравнение на числа (Compare num) и цикъл (for loop) за да се обходят всичките елементи на един масив. Важно е да се отбележи че ако подаденото име не отговаря на име на масив, то резултатът е недефиниран.
3. Четена на число от масив (Read array num) - Този възел се използва за да се прочете дадено число от масив. Той има три параметъра, име на масива, идекс на числото и резултат. Както във всички програмни езици тка и тук индексирането започва от нула. Т.е. първият елемент е с индекс 0, вторият е с индекс 1 и т.н. Когато резутата се поиска от друг възел от графа, този метод оценява входната връзка за индекс, след което от дадения масив се взима елемента с новооценения индекс и се подава на резултатния параметър. Важно е да се отбележи, че ако масивът има по-малко елементи от подадения индекс, то резутлатът е недефиниран.
4. Добавяне на число накрая (Push back num) - Този възел позволява да се добави нова стойност в масива на последна позиция, т.е. добавя се един елемент в края на пасива. Той има три параметра, входен поток на кода, име на масива и числова стойност която трябва да се добави. Когато потока на кода извика този метод, се оценява стойноста на входното число, добавя се нов елемент в края на масива и оценената стойност се записва в него.
5. Писане на число в масив (Write array num) - Този метод е реципрочен на писането на число в масив, той позволява на даден индекс в масив, ако съществува, да се запише число. Този метод има 4 параметъра, за приемане на потока на код, за стойност която да се запише в масива, за индекс на който да се запише стойноста и име на масива. Когато потокът на код "извика" този възел той оценятва параметъра за индекс и на дадения индекс в масива записва оценката на параметъра за стойност.  Както и в писането на число в масив, така и тук, е важно да се спомене че ако индекса е извън границите на масива, резултатът от тази операция е недефиниран.

### Методи за рисуване в платно (canvas)

Тези методи отговарят за всички основни операции платно за рисуване (canvas). За да работят коректно трябва да има добавен канвас в резултатния сайт. Когато има добавен канвас в страницата, в редактора на код могат да се използват две нови променливи - CANVAS_W и CANVAS_H, който са съответно пирочина и височина (canvas width, canvas height) на канваса за рисуване. Всички методи по-долу позволяват "рисува" извън платното, но само частта от фигурата която е вплатното ще бъде видима.
![First example](/documentation/images/canvasnodes.png)

1. Рисуване на правоъгълник (Draw rectangle) - Този възел позволява да се изрисува правоъгълник в даден цвят в платното за рисуване. Той има 6 параметъра, всичките входни, входен поток на кода, цвят на правоъгълника, точка от която да започне - тя се състой от два числови параметъра за Х и У координтаи, дължина на правоъгълника и ширина. Страните на правоъгълника са успоредни на страните на платното за рисуване. Целият правоъгълник се оцветява в избраният цвят. Ако върху него се изрисуват други фигури той се променв въпреки, че ще бъде "скрит" от тях.
2. Рисуване на линия (Draw line) - Този метод изрисува линия в платното. Той има шест параметъра, входен поток на кода, цвят на линията, точка от която започва и точка в която свършва, като всяка от последните две е създадена от два входни чисова параметъра за Х координта и У координата. След извикване от потока на кода се оценяват всички входни параметри и се изрисува права линия от стартовата точка до финалната такава. Както и при другите фигури ако върху линията се изрисуват други фигури това не я променя или премахва. 
3. Рисуване на кръг (Draw circle) - Този метод изрисува кръг в платното. Той има пет параметара, вход за поток на кода, цвят, център, който отново е описан от числови параметра за координати и радиус. Изрисува се кръг с дадения център и радиус, той не е защрихован. След като потока на кода предаде управлението на този възел, той оценява всичките си параметри и изрисува кръга.
4. Изчистване на правоъгълник (Clear rectangle) - Този метод служи за изчистване на част от платното. По същество той е абсолютно еднакъв с Рисуване на правоъгълник (Draw rectangle), но вмсест о да приема цвят той автоматично използва основния цвят на платното, който във момента може да бъде само бял.

## Основни примери


- Разглеждане на основните примери в нарастваща сложност
![First example](/documentation/images/example1.png)

# Заключение

- възможности за развитие
  - нови нодове
  - Работа с логически операции
  - Работа със стрингове
  - Динамично генериране на нодове от класове и функции
  - Верификация код графът на фронт-енд страната

# Източници

- [Wikipedia flow based programing](https://en.wikipedia.org/wiki/Flow-based_programming)
- https://github.com/newcat/baklavajs
- https://vuejs.org/


